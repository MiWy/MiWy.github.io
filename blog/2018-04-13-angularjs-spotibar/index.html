<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Michał Wyrwa's Homepage">
  <meta name="author" content="Michał Wyrwa">
  
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@">
    <meta name="twitter:creator" content="@">
    <meta name="twitter:title" content="[OLD] SpotiBar: ANGULARJS">
    <meta name="twitter:description" content="[This is a post from my old website. Outdated packages and libraries. Viewer discretion is advised ;-)]
PART 1 Zgodnie z poprzednim wpisem, rozbierzemy SpotiBar w wersji JavaScript na czynniki pierwsze. Użyjemy AngularJS, JavaScript i API Spotify.
Jako że to pierwszy kontakt z JavaScriptem jako takim i choć budowana przez nas aplikacja pewnie nie spełnia kryteriów dobrego kodu, to przynajmniej pokazuje, że mimo Mnogości JS-owych frameworków i możliwości, rozpoczęcie zabawy w developerkę nie jest trudne.">

    <meta property="og:url" content="/blog/2018-04-13-angularjs-spotibar/" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="[OLD] SpotiBar: ANGULARJS" />
    <meta property="og:description" content="[This is a post from my old website. Outdated packages and libraries. Viewer discretion is advised ;-)]
PART 1 Zgodnie z poprzednim wpisem, rozbierzemy SpotiBar w wersji JavaScript na czynniki pierwsze. Użyjemy AngularJS, JavaScript i API Spotify.
Jako że to pierwszy kontakt z JavaScriptem jako takim i choć budowana przez nas aplikacja pewnie nie spełnia kryteriów dobrego kodu, to przynajmniej pokazuje, że mimo Mnogości JS-owych frameworków i możliwości, rozpoczęcie zabawy w developerkę nie jest trudne." />


  <title>[OLD] SpotiBar: ANGULARJS | Michał Wyrwa</title>

  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <script src="https://kit.fontawesome.com/923575d7ad.js"></script>
  <link href="/css/prism.css" rel="stylesheet" />
  <link rel="stylesheet" href="/css/academicons.min.css" />
  <link href="/css/scarabisterre.css" rel="stylesheet">
  
  
  

</head>

<body>

  <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://miwy.github.io">Michał Wyrwa</a>
    </div>
    
    <div class="collapse navbar-collapse" id="bs-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li>
          <a href="/publications/">
            <i class="fa far fa-copy"></i>&nbsp;
            RESEARCH
          </a>
        </li>
        <li>
          <a href="/blog/">
            <i class="fa fas fa-quote-right"></i>&nbsp;
            BLOG
          </a>
        </li>
        <li>
          <a href="/teaching/">
            <i class="fa fas fa-user-graduate"></i>&nbsp;
            TEACHING
          </a>
        </li>
      </ul>
    </div>
  </div>
</nav>

  
  <div class="container">

    
    <div class="row">
      <div class="col-md-8 col-md-offset-2">

        <h2>[OLD] SpotiBar: ANGULARJS</h1>
        <p>
          <em>Fri, Apr 13, 2018</em>
        </p>
        <p>
          

<p>[This is a post from my old website. Outdated packages and libraries. Viewer discretion is advised ;-)]</p>

<h2 id="part-1">PART 1</h2>

<p>Zgodnie z poprzednim wpisem, rozbierzemy SpotiBar w wersji JavaScript na czynniki pierwsze. Użyjemy AngularJS, JavaScript i API Spotify.</p>

<p>Jako że to pierwszy kontakt z JavaScriptem jako takim i choć budowana przez nas aplikacja pewnie nie spełnia kryteriów dobrego kodu, to przynajmniej pokazuje, że mimo <a href="https://risingstars.js.org/2017/en/">Mnogości</a> JS-owych frameworków i możliwości, rozpoczęcie zabawy w developerkę nie jest trudne.</p>

<h3 id="użyte-frameworki-javascript-i-narzędzia">Użyte frameworki JavaScript i narzędzia</h3>

<ul>
<li>JavaScript</li>
<li><a href="https://angularjs.org">AngularJS</a> 1.6.x (na ten moment jest to wersja 1.6.9)</li>
<li>Kilka paczek Angularowych: <a href="https://github.com/angular-slider/angularjs-slider">angularjs-slider</a>, <a href="https://vitalets.github.io/checklist-model/">checklist-model</a>, <a href="https://github.com/eddiemoore/angular-spotify">angular-spotify</a></li>
<li><a href="https://developer.spotify.com/">Konto developerskie na Spotify</a></li>
<li>Terminal, przeglądarka i edytor tekstu</li>
</ul>

<h3 id="ustawiamy-workflow">Ustawiamy workflow</h3>

<p>Potrzebujemy małego serwera, żeby obsługiwać zwroty z serwera Spotify. Na Macu sprawa jest prosta, bo mamy preinstalowanego Pythona. Serwer lokalny odpalamy komendą &lsquo;python -m SimpleHTTPServer 8888&rsquo;, gdzie pod 8888 możemy wstawić interesujący nas port.</p>

<p><img src="/images/oldblog/Screen-Shot-2018-04-13-at-08.55.48.png" alt="image-center" />{: .align-center}</p>

<p>Alternatywne rozwiązania:</p>

<ul>
<li><a href="https://atom.io/packages/atom-live-server">atom-live-server</a>, dla użytkowników edytora <a href="https://atom.io/">Atom</a></li>
<li><a href="https://marketplace.visualstudio.com/items?itemName=ritwickdey.LiveServer">Live Server</a>, dla użytkowników edytora <a href="https://code.visualstudio.com/">Visual Studio Code</a> (pomimo kilkudniowych prób, nie udało mi się za jego pomocą obsłużyć callbacku od Spotify)</li>
<li><a href="https://www.mamp.info/en/">MAMP</a> i podobne</li>
</ul>

<p>Jeżeli używamy sposobu terminalowego, to trzeba pamiętać o odpaleniu komendy w katalogu naszego projektu, a nie np. w katalogu domowym.</p>

<p>Mając już prosty serwer możemy stworzyć folder projektu z podfolderami: <code>app</code> (w nim folder <code>lib</code>) i <code>views</code>. Struktura projektu jest konwencją, ale że ze ścieżek do plików będziemy korzystać, to warto pamiętać, gdzie jest jaki plik.</p>

<p>Ostatni krok to zarejestrowanie aplikacji w konsoli Spotify. Wchodzimy w <a href="https://developer.spotify.com/my-applications/">My Apps</a> i po zalogowaniu tworzymy nową aplikację.</p>

<p><img src="/images/oldblog/spotify_create_new_app.jpg" alt="image-center" />{: .align-center}</p>

<p>Następnie w jej ustawieniach dodajemy adres do callbacku, który będziemy potrzebować, by obsłużyć autoryzację ze strony Spotify. (możemy wpisać adres serwera lokalnego, pamiętając jednak, by kierował on na ten port, na który mamy ustawiony serwer).</p>

<p>![image-center](/images/oldblog/spotify_callback_url.jpg{: .align-center}</p>

<p>Na koniec kwestia bibliotek Angularowych. Można je ściągnąć z podlinkowanych wcześniej stron. Na repozytorium aplikacji też są wrzucone, więc równie dobrze można je pobrać <a href="https://github.com/MiWy/spotify-recommendations-app-js/tree/gh-pages/app/lib">stąd</a>. Obojętnie skąd je weźmiemy, mają wylądować w katalogu <code>app/lib</code>.</p>

<h2 id="part-2">PART 2</h2>

<p>Drogą przypomnienia, mamy przygotowane biblioteki JavaScriptowe, strukturę folderów projektu(*) utworzoną aplikację w konsoli dewelopera Spotify i serwer. Odpalamy serwer w katalogu naszego projektu.</p>

<p>*<strong>Oprócz wspomnianych w poprzednim wpisie plików, skopiować można również <a href="https://github.com/MiWy/spotify-recommendations-app-js/blob/gh-pages/app/style.css">ten</a> plik CSS. Wtedy na ekranie powinno się pojawiać dokładnie to samo :).</strong></p>

<h3 id="bazowy-plik-index-html">Bazowy plik index.html</h3>

<p>Użytkownik naszej prostej aplikacji będzie de facto przemieszczać się pomiędzy dwoma stronami: na jednej będzie ustalać kryteria wyszukiwania rekomendacji, na drugiej zaś wyświetlane będą wyniki. Nie będziemy do tego celu tworzyć osobnych pełnoprawnych plików HTML, tylko skorzystamy z obecnej w AngularJS możliwości dynamicznego podmieniania elementów HTML.</p>

<p>Naszym bazowym plikiem będzie umieszczony w wyjściowym folderze naszego projektu plik <code>index.html</code>. Pełen kod źródłowy znajduje się <a href="https://github.com/MiWy/spotify-recommendations-app-js/blob/gh-pages/index.html">w repozytorium</a>, tutaj opiszę tylko kluczowe kwestie.</p>

<h4 id="html"><html></h4>

<p>Oznaczenie Angularowe pojawia się już w pierwszym znaczniku:</p>

<pre><code class="language-html">    &lt;html ng-app=&quot;spotiBar&quot;&gt;
</code></pre>

<p><code>ng-app</code> mówi Angularowi jaki jest najbardziej podstawowy element naszej aplikacji, rejestruje ją dla frameworku. Równie dobrze można w tym przypadku dać ten atrybut w elemencie <code>body</code>.</p>

<h4 id="head"><head></h4>

<p>W elemencie <code>&lt;head&gt;</code> mamy zbiór odwołań do plików .css i .js. Niektóre z nich mają standardową strukturę, przykładowo dla elementu <code>script</code> jest podana ścieżka do pliku w określonej lokalizacji na dysku. Dla celów pokazowych, nie wszystkie pliki są tak ładowane :).  Na przykład pliki Bootstrapowe są ładowane z serwerów Bootstrapa, nie z dysku.</p>

<p>Ma to swoje plusy i minusy, z jednej strony jest szansa, że takie korzystanie z <a href="https://gtmetrix.com/why-use-a-cdn.html">CDN</a> (<em>content delivery network</em>) pozwoli na szybsze załadowanie strony. Z drugiej strony, jak serwery, na których jest dany plik umieszczony, się posypią, to nasza strona też może ucierpieć.</p>

<p>Ostatnią sprawą jest znacznik <code>&lt;base /&gt;</code>. Ułatwia on życie, pozwalając na zdefiniowanie adresu bazowego naszej strony internetowej. Pozostawienie go na <code>/</code> oznacza, że podstrony będą się ładować na zasadzie:</p>

<p>www.example.com/podstrona</p>

<p>Zaś ustawienie <code>&lt;base href=&quot;/bazowylink/&quot;/&gt;</code> spowoduje, że strony będą szukane pod:</p>

<p>www.example.com/bazowylink/podstrona</p>

<pre><code class="language-html">    &lt;head&gt;
      &lt;title&gt;SpotiBar&lt;/title&gt;
      &lt;base href=&quot;/&quot;&gt;
    
      &lt;link rel=&quot;stylesheet&quot; href=&quot;https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css&quot; 
        integrity=&quot;sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm&quot;
        crossorigin=&quot;anonymous&quot;&gt;
      &lt;link href=&quot;https://fonts.googleapis.com/css?family=Lobster&quot; rel=&quot;stylesheet&quot;&gt;
      &lt;link href=&quot;https://fonts.googleapis.com/css?family=Cabin&quot; rel=&quot;stylesheet&quot;&gt;
      &lt;link rel=&quot;stylesheet&quot; href=&quot;app/style.css&quot;&gt;
      &lt;script src=&quot;https://code.jquery.com/jquery-3.2.1.slim.min.js&quot; 
        integrity=&quot;sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN&quot;
        crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;
      &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js&quot; 
        integrity=&quot;sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q&quot;
        crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;
      &lt;script src=&quot;https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js&quot; 
        integrity=&quot;sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl&quot;
        crossorigin=&quot;anonymous&quot;&gt;&lt;/script&gt;
      &lt;script src=&quot;app/lib/angular.min.js&quot;&gt;&lt;/script&gt;
      &lt;script src=&quot;app/lib/angular-route.min.js&quot;&gt;&lt;/script&gt;
      &lt;script src=&quot;app/lib/checklist-model.js&quot;&gt;&lt;/script&gt;
      &lt;script src=&quot;app/lib/angular-spotify.min.js&quot;&gt;&lt;/script&gt;
      &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;app/lib/rzslider.min.css&quot; /&gt;
      &lt;script src=&quot;app/lib/rzslider.min.js&quot;&gt;&lt;/script&gt;
      &lt;script src=&quot;app/app.js&quot;&gt;&lt;/script&gt;
    &lt;/head&gt;
</code></pre>

<h4 id="body"><body></h4>

<p>W tym momencie zrobimy tylko pasek nawigacyjny z przyciskiem do logowania.</p>

<p>Kod wygląda tak:</p>

<pre><code class="language-html">    &lt;nav ng-controller=&quot;LoginController&quot; class=&quot;navbar navbar-inverse altnavbg&quot; role=&quot;navigation&quot;&gt;
      &lt;div class=&quot;container-fluid&quot;&gt;
        &lt;div class=&quot;navbar-header&quot;&gt;
          &lt;a class=&quot;navbar-brand&quot; href=&quot;/#!/search&quot;&gt;SpotiBar - Advanced Spotify Search&lt;/a&gt;
        &lt;/div&gt;
        &lt;ul class=&quot;nav navbar-nav navbar-right&quot;&gt;
          &lt;button type=&quot;button&quot; class=&quot;btn btn-default navbar-btn&quot; ng-click=&quot;login()&quot;&gt;Login&lt;/button&gt;
        &lt;/ul&gt;
      &lt;/div&gt;
    &lt;/nav&gt;
</code></pre>

<p>Prawie wszystkie atrybuty elementów są Bootstrapowe i nie będziemy ich w tym miejscu tłumaczyć. Dokumentacja Bootstrapa jest przyjazna użytkownikowi :). Natomiast kilka rzeczy jest Angularowych. Atrybut <code>ng-controller</code> jest dyrektywą Angulara. Określa jaki fragment kodu będzie obsługiwać wskazaną część strony.</p>

<p>Warta zwrócenia uwagi jest też wartość atrybutu <code>href</code> dla naszego <code>navbar-brand</code>, czyli <code>/#!/search</code>. <code>#!</code>  bierze się stąd, że delegujemy przekierowania Angularowi, a on domyślnie wykorzystuje to wyrażenie. Jak zobaczymy w kolejnej części, link ten nie tyle ładuje zupełnie nową stronę HTML, co mówi Angularowi, aby zmodyfikował DOM i pokazał opcje wyszukiwania na aktualnie wyświetlanej stronie (czyli index.html). <a href="https://www.digitalocean.com/community/tutorials/introduction-to-the-dom">Co to DOM</a>?</p>

<p>Ostatnia sprawa to dyrektywa <code>ng-click</code>. Znowu Angular, wykorzystamy ją, by zarejestrować chęć zalogowania się przez użytkownika. O różnicy pomiędzy <code>ng-click</code> a <code>onclick</code> można poczytać na <a href="https://stackoverflow.com/a/20274848">stackoverflow</a>.</p>

<h3 id="autoryzacja-oauth">Autoryzacja OAuth</h3>

<p>Do korzystania z API Spotify użytkownik musi przejść przez proces <a href="https://developer.spotify.com/web-api/authorization-guide/">autoryzacji</a>. Uwierzytelnienie polega na wysłaniu żądania wraz z kluczem naszej aplikacji i odebraniu tokena zwrotnego. Token musi być następnie dołączany do wysyłanych przez użytkownika kolejnych zapytań do API.</p>

<p>Do komunikacji z API skorzystamy z przygotowanego pod AngularJS <a href="https://github.com/eddiemoore/angular-spotify">angular-spotify</a>.</p>

<h4 id="callback-html">callback.html</h4>

<p>Potrzebujemy prostego pliku HTML, do którego Spotify będzie odsyłać token po skończonej autoryzacji. Autor angular-spotify dostarcza templatkę takowego pliku, <a href="https://github.com/eddiemoore/angular-spotify/blob/master/examples/callback.html">o tutaj</a>. Wystarczy nam ona w zupełności. Kopiujemy ją do głównego folderu naszego projektu.</p>

<p>Autoryzacja przebiega żądaniem GET, więc ten mały skrypcik w pliku <code>callback.html</code> patrzy po pasku adresowym okna i, jeżeli go znajdzie, zapisuje token w pamięci przeglądarki (<code>localStorage</code>) i zamyka okno, a jeśli nie to tylko zamyka okno.</p>

<p>W poprzednim wpisie ustawialiśmy <strong>Redirect URI</strong> dla naszej aplikacji Spotify (w <a href="https://beta.developer.spotify.com/dashboard">konsoli dewelopera</a>). Jeżeli zmienimy nazwę <code>callback.html</code> na coś innego, to musimy również w ustawieniach aplikacji zmienić przekierowanie.</p>

<h4 id="app-js">app.js</h4>

<p>Zakładając, że w naszym pliku <code>index.html</code> mamy wszystko to, co powyżej opisane, tworzymy nowy plik: <code>app.js</code> w folderze <code>app</code>.</p>

<p>W pierwszej kolejności, musimy stworzyć instancję naszej aplikacji (w zasadzie - moduł) dla AngularJS. Składnia wygląda tak:</p>

<pre><code class="language-javascript">    const spotiBar = angular.module(&quot;spotiBar&quot;, [
      &quot;spotify&quot;
    ]);
</code></pre>

<p>O ile w pliku <code>index.html</code> nadaliśmy wartość <code>spotiBar</code> atrybutowi <code>ng-app</code>, to tutaj musi się pojawić ta sama nazwa.</p>

<p>W nawiasie kwadratowym wymieniamy paczki, z których będziemy korzystać. Póki co będziemy korzystać tylko z &ldquo;spotify&rdquo; właśnie :). Resztę dodamy później.</p>

<p>Następnie czeka nas odrobinę konfiguracji:</p>

<pre><code class="language-javascript">    spotiBar.config([
      &quot;SpotifyProvider&quot;,
      function(SpotifyProvider) {
        
        SpotifyProvider.setClientId(&quot;CLIENT_ID&quot;);
        SpotifyProvider.setRedirectUri(&quot;http://localhost:8080/callback.html&quot;);
        SpotifyProvider.setScope(&quot;playlist-read-private&quot;);
    
        if (localStorage.getItem(&quot;spotify-token&quot;)) {
          SpotifyProvider.setAuthToken(localStorage.getItem(&quot;spotify-token&quot;));
          console.log(&quot;Token got from localStorage.&quot;);
        } else {
          console.log(&quot;There was no token in localStorage.&quot;);
        }
      }
    ]);
</code></pre>

<p>W nawiasie kwadratowym wymieniamy, ponownie, zależności (w tym wypadku <code>SpotifyProvider</code> z angular-spotify), a następnie implementujemy funkcję konfiguracyjną.</p>

<p>Pod <code>CLIENT_ID</code> podajemy client id wzięty ze strony naszej aplikacji w konsoli dewelopera Spotify (<strong>NIE</strong> secret, tylko &ldquo;zwykły&rdquo;).</p>

<p>Pod <code>.setRedirectUri</code>wklepujemy adres do callbacku, zgodny z naszym serwerem lokalnym, nazwą pliku callbackowego, oraz zgodny z tym, który wpisaliśmy w ustawieniach aplikacji w konsoli Spotify*****.</p>

<p>Pod <code>.setScope</code> definiujemy jakie upoważnienia użytkownik naszej aplikacji ma nam nadać (dla celów przykładowych u nas jest to odczytanie jego prywatnych playlist). Pełny zestaw scope&rsquo;ów znaleźć można <a href="https://developer.spotify.com/web-api/using-scopes/">tutaj</a>.</p>

<p>Wyrażenie warunkowe <code>if</code> sprawdza, czy w pamięci lokalnej przeglądarki jest już token. Jeśli tak, zapisujemy go do <code>SpotifyProvidera</code> i dostajemy zwrotny komunikat w konsoli. Jeśli nie, to czeka nas tylko komunikat zwrotny w konsoli ;).</p>

<p>Ok. Brakuje nam tylko jednej rzeczy: kodu kontrolera, odpowiedzialnego za logowanie użytkownika!</p>

<pre><code class="language-Javascript">    spotiBar.controller(&quot;LoginController&quot;, [
      &quot;$scope&quot;,
      &quot;Spotify&quot;,
      function($scope, Spotify) {
        $scope.login = function() {
          Spotify.login().then(
            function(data) {
              console.log(data);
              Spotify.setAuthToken(data);
              alert(&quot;You are now logged in&quot;);
            },
            function() {
              console.log(&quot;didn't log in&quot;);
            }
          );
        };
      }
    ]);
</code></pre>

<p>Podobnie jak poprzednio, na początku nawiasu kwadratowego wymieniamy potrzebne zależności (<code>$scope</code> i <code>Spotify</code>). <code>$scope</code> to obiekt w Angular pozwalający na komunikację pomiędzy HTML a JS.</p>

<p>Czyli pisząc <code>$scope.login =</code>, definiujemy funkcję, do której w pliku <code>index.html</code> odwoływaliśmy się pisząc <code>ng-click=login()</code>.</p>

<p>Funkcja <code>Spotify.login()</code>, z kolei, to metoda z angular-spotify, wysyłająca żądanie autoryzacji do Spotify. Po zakończeniu autoryzacji, o ile zakończyła się sukcesem, zapisuje informację o tokenie w obiekcie Spotify, którym później będziemy wyszukiwać rekomendacji muzycznych. Jest też wyświetlany alert z informacją o logowaniu.</p>

<h2 id="logujemy-się">Logujemy się</h2>

<p>Jeśli nasz serwer nadal jest włączony to wchodzimy na nasze <a href="http://localhost:8888">http://localhost:8888</a> (ew. inny port) i patrzymy. Zakładając, że mamy te same pliki CSS, powinno to wyglądać tak:</p>

<p><img src="/images/oldblog/Screen-Shot-2018-04-14-at-17.58.32.png" alt="image-center" />{: .align-center}</p>

<p>Gdy klikniemy w przycisk &ldquo;Login&rdquo;, wyskoczy okienko proszące o potwierdzenie (ew. zalogowanie do Spotify, jeśli nie byliście w przeglądarce zalogowani). Po jego kliknięciu, przekierowanie pchnie token do callback.html, okienko zniknie, a nam ukaże się:</p>

<p><img src="/images/oldblog/Screen-Shot-2018-04-14-at-17.58.59.png" alt="image-center" />{: .align-center}</p>

<p>Token ma termin ważności, gdy się wyczerpie, będziemy musieli zalogować się ponownie (inne metody autoryzacji pozwalają na odświeżanie tokenu, w angular-spotify tego nie ma).</p>

<p>Następnym razem zajmiemy się stworzeniem widoku z kryteriami wyszukiwania :).</p>

<p>(*) Jeśli okienko z autoryzacją się samo nie zamyka, tylko pojawia się błąd 404 albo informacja o złym redirect_uri, to trzeba pokombinować trochę z ustawieniem adresu callbacku w konsoli dewelopera Spotify, i ustawieniami w naszej konfiguracji <code>SpotifyProvider</code>. Raz mi działa, kiedy podaję bezpośrednio z końcówką &ldquo;.html&rdquo;, a raz bez. &hellip; ;)</p>

<h2 id="part-3">PART 3</h2>

<p>W tym odcinku dodamy do naszej aplikacji formularz, zbierający kryteria wyszukiwania oraz widokiem wyświetlającym rezultaty.</p>

<h3 id="index-html">index.html</h3>

<p>Jako, że chcemy by Angular sam uzupełniał DOM o potrzebne elementy HTML, musimy oznaczyć miejsce, w którym ma to robić. Służy temu dyrektywa <code>ng-view</code>.</p>

<p>W pliku <code>index.html</code> pod elementem <code>&lt;nav&gt;&lt;/nav&gt;</code> dodajemy:</p>

<pre><code class="language-html">    &lt;main ng-view&gt;
</code></pre>

<h3 id="app-js-2">app.js (2)</h3>

<p>By scedować zarządzanie przekierowaniami na stronie Angularowi musimy skonfigurować moduł AngularJS, który domyślnie nie jest ładowany: ngRoute.</p>

<p>Zmodyfikujemy w tym celu pierwszą linijkę pliku app.js, w której inicjowaliśmy naszą aplikację:</p>

<pre><code class="language-javascript">    const spotiBar = angular.module(&quot;spotiBar&quot;, [
      &quot;ngRoute&quot;,
      &quot;checklist-model&quot;,
      &quot;rzModule&quot;,
      &quot;spotify&quot;
    ]);
</code></pre>

<p>Oprócz ngRoute dodaliśmy od razu <a href="https://vitalets.github.io/checklist-model/">checklist-model</a> oraz <a href="https://github.com/angular-slider/angularjs-slider">rzModule</a>, czyli dodatkowe biblioteki, które ułatwią nam pracę z formularzami.</p>

<p>ngRoute trzeba stosownie skonfigurować, do naszej funkcji konfigurującej dodajemy:</p>

<pre><code class="language-javascript">    spotiBar.config([
      &quot;$routeProvider&quot;,
      &quot;SpotifyProvider&quot;,
      function($routeProvider, SpotifyProvider) {
        $routeProvider
          .when(&quot;/&quot;, {
            redirectTo: &quot;/search&quot;
          })
          .when(&quot;/search&quot;, {
            templateUrl: &quot;views/search.html&quot;,
            controller: &quot;SearchController&quot;
          })
          .when(&quot;/results&quot;, {
            templateUrl: &quot;views/results.html&quot;,
            controller: &quot;ResultsController&quot;
          });
        // Poniżej reszta z poprzednich części: SpotifyProvider.setClientId()....
        // A także sprawdzenie obecności tokena w localStorage: if(localStorage.getItem())....
      }
    ]);
</code></pre>

<p>Dzięki temu, kiedy użytkownik kliknie link odsyłający do, dajmy na to, <code>/search</code>, Angular będzie wiedział jaki fragment HTML ma dodać w miejsce naszego <code>ng-view</code> w <code>index.html</code> (będzie to fragment zlokalizowany w <code>views/search.html</code>) oraz jaki kontroler jest tam używany (<code>SearchController</code>).</p>

<p>Przypadek <code>.when(&quot;/&quot;, {})</code> to przypadek wejścia na stronę główną. Również wtedy Angular ma załadować to samo, co w momencie przekierowania na <code>/search</code>.</p>

<h3 id="search-html">search.html</h3>

<p>Tworzymy plik <code>search.html</code> w folderze <code>/views</code>.</p>

<p>Kod formularza wyszukiwania jest dosyć długi, gdyż jest wiele kryteriów, które użytkownik może ustawić.</p>

<pre><code class="language-html">    &lt;div class=&quot; row justify-content-center&quot;&gt;
            &lt;button type=&quot;button&quot; class=&quot;btn-primary&quot; ng-click=&quot;searchRecommendations()&quot;&gt;Search recommendations&lt;/button&gt;
    &lt;/div&gt;
    &lt;div class=&quot;container row&quot;&gt;
        &lt;div class=&quot;col-md-1&quot;&gt;&lt;/div&gt;
        &lt;div class=&quot;col-md-4&quot;&gt;
          &lt;div class=&quot;form-group &quot;&gt;
            &lt;form&gt;
              &lt;input type=&quot;submit&quot; ng-click=&quot;searchSeeds()&quot; class=&quot;btn-warning&quot; value=&quot;Search for seeds&quot;&gt;
                &lt;input type=&quot;text&quot;  ng-model=&quot;seedsQuery&quot; placeholder=&quot;Enter seeds query&quot;/&gt;
              &lt;label class=&quot;spotify-font-color&quot;&gt;Limit (1-100):
                &lt;input type=&quot;number&quot; min=&quot;1&quot; max=&quot;100&quot; ng-model=&quot;limit&quot; /&gt;
              &lt;/label&gt;
              &lt;br /&gt;
              &lt;label class=&quot;spotify-font-color&quot;&gt;Duration (in seconds):
                &lt;input type=&quot;number&quot; ng-model=&quot;duration&quot; /&gt;
              &lt;/label&gt;
              &lt;br /&gt;
              &lt;label class=&quot;spotify-font-color&quot;&gt;Key (0 = C, 2 = D, and so on):
                &lt;input type=&quot;number&quot; min=&quot;0&quot; max=&quot;11&quot; value=&quot;0&quot; ng-model=&quot;key&quot; /&gt;
              &lt;/label&gt;
              &lt;br /&gt;
              &lt;label  class=&quot;spotify-font-color&quot;&gt;Major/Minus (1/0):
                &lt;input type=&quot;number&quot; min=&quot;0&quot; max=&quot;1&quot; value=&quot;0&quot; ng-model=&quot;ismajor&quot; /&gt;
              &lt;/label&gt;
              &lt;br /&gt;
              &lt;label  class=&quot;spotify-font-color&quot;&gt;Tempo (BPM):
                &lt;input type=&quot;number&quot; min=&quot;0&quot; max=&quot;1000&quot; value=&quot;120&quot; ng-model=&quot;tempo&quot; /&gt;
              &lt;/label&gt;
              &lt;br /&gt;
    
              &lt;div&gt;
                &lt;label class=&quot;spotify-font-color&quot;&gt;Acousticness:
                  &lt;input type=&quot;text&quot; ng-model=&quot;sliderAcousticness&quot; /&gt;
                &lt;/label&gt;
                &lt;br/&gt;
                &lt;rzslider rz-slider-model=&quot;sliderAcousticness&quot; rz-slider-options=&quot;{floor: 0, ceil: 100, step: 1, showSelectionBar: true}&quot;&gt;&lt;/rzslider&gt;
              &lt;/div&gt;
              &lt;div&gt;
                &lt;label class=&quot;spotify-font-color&quot;&gt;Danceability:
                  &lt;input type=&quot;text&quot; min=&quot;0&quot; max=&quot;100&quot; ng-model=&quot;sliderDanceability&quot; /&gt;
                &lt;/label&gt;
                &lt;rzslider rz-slider-model=&quot;sliderDanceability&quot; rz-slider-options=&quot;{floor: 0, ceil: 100, step: 1, precision: 1}&quot;&gt;&lt;/rzslider&gt;
              &lt;/div&gt;
              &lt;div&gt;
                &lt;label class=&quot;spotify-font-color&quot;&gt;Energy:
                  &lt;input type=&quot;text&quot; min=&quot;0&quot; max=&quot;100&quot; ng-model=&quot;sliderEnergy&quot; /&gt;
                &lt;/label&gt;
                &lt;rzslider rz-slider-model=&quot;sliderEnergy&quot; rz-slider-options=&quot;{floor: 0, ceil: 100, step: 1, precision: 1}&quot;&gt;&lt;/rzslider&gt;
              &lt;/div&gt;
              &lt;div&gt;
                &lt;label class=&quot;spotify-font-color&quot;&gt;Liveness:
                  &lt;input type=&quot;text&quot; min=&quot;0&quot; max=&quot;100&quot; ng-model=&quot;sliderLiveness&quot; /&gt;
                &lt;/label&gt;
                &lt;rzslider rz-slider-model=&quot;sliderLiveness&quot; rz-slider-options=&quot;{floor: 0, ceil: 100, step: 1, precision: 1}&quot;&gt;&lt;/rzslider&gt;
              &lt;/div&gt;
              &lt;div&gt;
                &lt;label class=&quot;spotify-font-color&quot;&gt;Instrumentalness:
                  &lt;input type=&quot;text&quot; min=&quot;0&quot; max=&quot;100&quot; ng-model=&quot;sliderInstrumentalness&quot; /&gt;
                &lt;/label&gt;
                &lt;rzslider rz-slider-model=&quot;sliderInstrumentalness&quot; rz-slider-options=&quot;{floor: 0, ceil: 100, step: 1, precision: 1}&quot;&gt;&lt;/rzslider&gt;
              &lt;/div&gt;
              &lt;div&gt;
                &lt;label class=&quot;spotify-font-color&quot;&gt;Popularity:
                  &lt;input type=&quot;text&quot; min=&quot;0&quot; max=&quot;100&quot; ng-model=&quot;sliderPopularity&quot; /&gt;
                &lt;/label&gt;
                &lt;rzslider rz-slider-model=&quot;sliderPopularity&quot; rz-slider-options=&quot;{floor: 0, ceil: 100, step: 1, precision: 1}&quot;&gt;&lt;/rzslider&gt;
              &lt;/div&gt;
              &lt;div&gt;
                &lt;label class=&quot;spotify-font-color&quot;&gt;Speechiness:
                  &lt;input type=&quot;text&quot; min=&quot;0&quot; max=&quot;100&quot; ng-model=&quot;sliderSpeechiness&quot; /&gt;
                &lt;/label&gt;
                &lt;rzslider rz-slider-model=&quot;sliderSpeechiness&quot; rz-slider-options=&quot;{floor: 0, ceil: 100, step: 1, precision: 1}&quot;&gt;&lt;/rzslider&gt;
              &lt;/div&gt;
              &lt;div&gt;
                &lt;label class=&quot;spotify-font-color&quot;&gt;Valence:
                  &lt;input type=&quot;text&quot; min=&quot;0&quot; max=&quot;100&quot; ng-model=&quot;sliderValence&quot; /&gt;
                &lt;/label&gt;
                &lt;rzslider rz-slider-model=&quot;sliderValence&quot; rz-slider-options=&quot;{floor: 0, ceil: 100, step: 1, precision: 1}&quot;&gt;&lt;/rzslider&gt;
              &lt;/div&gt;
            &lt;/form&gt;
          &lt;/div&gt;
        &lt;/div&gt;
    
        &lt;div class=&quot;col-md-7&quot;&gt;
          &lt;div class=&quot;form-group&quot;&gt;
          &lt;/div&gt;
          &lt;div class=&quot;container row&quot;&gt;
            &lt;div class=&quot;col-md-4&quot;&gt;
              &lt;p class=&quot;spotify-font-color&quot;&gt;Artists:&lt;/p&gt;
              &lt;div class=&quot;row&quot; ng-repeat=&quot;artist in seedsArtists&quot;&gt;
                &lt;input type=&quot;checkbox&quot; checklist-model=&quot;seedsSelection.artists&quot; checklist-value=&quot;artist.id&quot; /&gt; 
                &lt;span class=&quot;spotify-font-color&quot;&gt;{{artist.name}}&lt;/span&gt;
              &lt;/div&gt;
            &lt;/div&gt;
            &lt;div class=&quot;col-md-6&quot;&gt;
              &lt;p class=&quot;spotify-font-color&quot;&gt;Tracks:&lt;/p&gt;
              &lt;div class=&quot;row&quot; ng-repeat=&quot;track in seedsTracks&quot;&gt;
                &lt;input type=&quot;checkbox&quot; checklist-model=&quot;seedsSelection.tracks&quot; checklist-value=&quot;track.id&quot; /&gt; 
                &lt;span class=&quot;spotify-font-color&quot;&gt;{{track.name}} -&lt;/span&gt;
                &lt;span class=&quot;spotify-font-color&quot; ng-repeat=&quot;artist in track.artists&quot;&gt; &amp;nbsp;{{artist.name}} &lt;/span&gt;
              &lt;/div&gt;
            &lt;/div&gt;
            &lt;div class=&quot;col-md-2&quot;&gt;
              &lt;p class=&quot;spotify-font-color&quot;&gt;Genres:&lt;/p&gt;
              &lt;div class=&quot;row&quot; ng-repeat=&quot;genre in seedsGenres&quot;&gt;
                &lt;input type=&quot;checkbox&quot; checklist-model=&quot;seedsSelection.genres&quot; checklist-value=&quot;genre&quot; /&gt; 
                &lt;span class=&quot;spotify-font-color&quot;&gt;{{genre}}&lt;/span&gt;
              &lt;/div&gt;
            &lt;/div&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;
</code></pre>

<p>Za rozpoczęcie wyszukiwania na bazie ustalonych w formularzu przez użytkownika kryteriów odpowiada obecny w 2 linijce kodu element <code>&lt;button&gt;</code>, z atrybutem <code>ng-click=&quot;searchRecommendations()&quot;</code>, odwołującym się do funkcji w kontrolerze <code>SearchController</code>, którą zaraz napiszemy.</p>

<p>Analogicznie, w linijce 9, mamy <code>input</code> z<code>ng-click=&quot;searchSeeds()&quot;</code>. Jednym z kryteriów wyszukiwania rekomendacji w Spotify są artyści, utwory i gatunku muzyczne. Funkcja <code>searchSeeds</code> posłuży nam do wygenerowania z nimi listy na podstawie hasła wpisanego przez użytkownika.</p>

<p>Wszystkie <code>ng-model</code> informują Angular, pod jaką nazwą ma trzymać dane zebrane w danym polu formularza. Wszystkie dane zebrane z poziomu HTML są w AngularJS trzymane w obiekcie <code>$scope</code>, do którego będziemy się odwoływać implementując nasz kontroler.</p>

<p><code>rz-slider-model</code>, <code>checklist-model</code>,  - te atrybuty definiują, analogicznie do <code>ng-model,</code> pod jaką nazwą właściwości <code>$scope</code> Angular ma trzymać dane ze sliderów i checkboxów (i pochodzą z wcześniej przez nas dodanych do naszej aplikacji bibliotek).</p>

<p><code>rz-slider-options</code> definiuje dodatkowo ustawienia slidera. W kodzie ustawiony jest zakres wartości oraz stopień minimalnej zmiany wartości.</p>

<p><code>ng-repeat</code> to dyrektywa pozwalająca nam na dynamiczne tworzenie iteracji danych elementów HTML, czyli po prostu w pętli. Przykładowo w linijce 93, jeśli w <code>seedsArtist</code> jest 100 artystów, to cały element <code>&lt;div&gt;</code> (wraz z wewnętrzną strukturą) będzie wygenerowany 100 razy.</p>

<p><code>checklist-value</code> ustanawia wartość checkboxa, czyli jak użytkownik zaznaczy dany checkbox, to ten atrybut mówi naszej aplikacji, co ma trzymać w pamięci.</p>

<p>Z kolei zapis taki, jak w linijce 95: <code>{{artist.name}}</code>, podwójne klamry, to składnia Angulara, wiążąca dane ukryte pod <code>artist.name</code> (siedzące naturalnie w obiekcie <code>$scope</code>) tak, że na naszej stronie widzimy, w tym wypadku, imię danego wykonawcy, a nie dosłowny string &ldquo;{{artist.name}}&rdquo;.</p>

<h3 id="app-js-searchcontroller">app.js SearchController</h3>

<p>Powracając do pliku app.js, zaczynamy pisać kod kontrolera:</p>

<pre><code class="language-javascript">    spotiBar.controller(&quot;SearchController&quot;, [
      &quot;$scope&quot;,
      &quot;Spotify&quot;,
      function($scope, Spotify) {
        // Tutaj będą funkcje kontrolera
      }
    ]);
</code></pre>

<p>Jak widzimy, będziemy się odwoływać do obiektu $scope, pozwalającemu nam pobrać ustawione przez użytkownika kryteria, a w dalszym planie także wyświetlić użytkownikowi wyniki. Pierwsza funkcja, którą napiszemy, to obecna w search.html i przywołana już funkcja searchSeeds.</p>

<p>W obrębie naszego kontrolera:</p>

<pre><code class="language-javascript">    let seedsSelection = {};
    
    $scope.searchSeeds = function() {
      $scope.seedsSelection = seedsSelection;
      Spotify.getAvailableGenreSeeds().then(
        function(data) {
          $scope.seedsGenres = data.data.genres;
        },
        function(error) {
          alert(&quot;The access token expired. Please login again.&quot;);
        }
      );
      Spotify.search($scope.seedsQuery, &quot;artist&quot;).then(function(data) {
        $scope.seedsArtists = data.data.artists.items;
      });
      Spotify.search($scope.seedsQuery, &quot;track&quot;).then(function(data) {
        $scope.seedsTracks = data.data.tracks.items;
      });
    };
</code></pre>

<p>Tworzymy obiekt seedsSelection, będziemy w nim przetrzymywać wybrane przez użytkownika nazwy artystów/utworów/gatunków muzycznych. Wiążemy go z obecnym w $scope seedsSelection.</p>

<p>Spotify API posiada szereg rodzajów zapytań do bazy. Jednym z nich jest żądanie zwrócenia listy dostępnych gatunków muzycznych. Do tej metody odwołujemy się w linijce 5. Jeśli zakończy się ona sukcesem, to zwrócona zostanie lista gatunków w formacie JSON w obiekcie <code>data</code>. Przypisujemy te dane do <code>$scope.seedsGenres</code>, a kod w <code>search.html</code> w linijkach 108-111 wyświetli je użytkownikowi. Dodatkowo kontrolujemy ewentualne wystąpienie błędu połączenia, będzie to oznaczać, że token uzyskany przez użytkownika w trakcie autoryzacji przestał być ważny i trzeba się zalogować na nowo. Analogicznie z zapytaniami o artystów i utwory, ale tutaj już tego sprawdzenia błędu nie obsługujemy, jako że wszystkie metody są wykonywane mniej więcej w tym samym czasie.</p>

<p>Następną funkcję, dokonanie właściwego wyszukania rekomendacji, podzielimy na szereg funkcji:</p>

<pre><code class="language-javascript">    $scope.searchRecommendations = function() {
         if (checkIfSeedsInLimit()) {
           Spotify.getRecommendations(prepCriteria()).then(
             function(data) {
               //Zrób coś z wynikami wyszukania, np. wypisz je w konsoli przeglądarki.
               console.log(data);
               // Przekieruj okno przeglądarki pod widok z wynikami.
               document.location.href = &quot;/#!/results&quot;;
             },
             function(error) {
               alert(&quot;The access token expired. Please login again.&quot;);
             }
           );
         } else {
           alert(&quot;You can select up to 5 different seeds.&quot;);
         }
       };
    
       checkIfSeedsInLimit = function() {
         if (
           $scope.seedsSelection == undefined ||
           ($scope.seedsSelection.artists == undefined &amp;&amp;
             $scope.seedsSelection.tracks == undefined &amp;&amp;
             $scope.seedsSelection.genres == undefined)
         ) {
           alert(&quot;You did not define any seeds&quot;);
           return false;
         }
    
         let numberOfSeeds = 0;
         if (!($scope.seedsSelection.artists == undefined)) {
           numberOfSeeds =
             numberOfSeeds + Object.keys($scope.seedsSelection.artists).length;
         }
         if (!($scope.seedsSelection.genres == undefined)) {
           numberOfSeeds =
             numberOfSeeds + Object.keys($scope.seedsSelection.genres).length;
         }
         if (!($scope.seedsSelection.tracks == undefined)) {
           numberOfSeeds =
             numberOfSeeds + Object.keys($scope.seedsSelection.tracks).length;
         }
         if (0 &lt; numberOfSeeds &amp;&amp; 5 &gt;= numberOfSeeds) {
           return true;
         } else {
           return false;
         }
       };
    
       prepCriteria = function() {
         let criteria = {};
         if ($scope.seedsSelection.artists != undefined) {
           criteria.seed_artists = $scope.seedsSelection.artists.join();
         }
         if ($scope.seedsSelection.tracks != undefined) {
           criteria.seed_tracks = $scope.seedsSelection.tracks.join();
         }
         if ($scope.seedsSelection.genres != undefined) {
           criteria.seed_genres = $scope.seedsSelection.genres.join();
         }
         if ($scope.limit != null) {
           criteria.limit = $scope.limit;
         }
         if ($scope.duration != null) {
           criteria.target_duration_ms = $scope.duration;
         }
         if ($scope.key != null) {
           criteria.target_key = $scope.key;
         }
         if ($scope.ismajor != null) {
           criteria.target_mode = $scope.ismajor;
         }
         if ($scope.tempo != null) {
           criteria.target_tempo = $scope.tempo;
         }
         if (!isNaN($scope.sliderAcousticness)) {
           criteria.target_acousticness = $scope.sliderAcousticness / 100;
         }
         if (!isNaN($scope.sliderDanceability)) {
           criteria.target_danceability = $scope.sliderDanceability / 100;
         }
         if (!isNaN($scope.sliderEnergy)) {
           criteria.target_energy = $scope.sliderEnergy / 100;
         }
         if (!isNaN($scope.sliderInstrumentalness)) {
           criteria.target_instrumentalness = $scope.sliderInstrumentalness / 100;
         }
         if (!isNaN($scope.sliderLiveness)) {
           criteria.target_liveness = $scope.sliderLiveness / 100;
         }
         if (!isNaN($scope.sliderPopularity)) {
           criteria.target_popularity = $scope.sliderPopularity / 100;
         }
         if (!isNaN($scope.sliderSpeechiness)) {
           criteria.target_speechiness = $scope.sliderSpeechiness / 100;
         }
         if (!isNaN($scope.sliderValence)) {
           criteria.target_valence = $scope.sliderValence / 100;
         }
         return criteria;
       };
</code></pre>

<p>Funkcja <code>searchRecommendations</code> rozpoczyna się od sprawdzenia poprawności wybranych przez użytkownika seedów (czyli utworów, artystów i gatunków): funkcja <code>checkIfSeedsInLimit</code>. Według ograniczeń Spotify API użytkownik musi wybrać ich w przedziale 1-5 (zawsze musi wybrać coś, ale nie więcej niż 5 łącznie). Jeżeli będzie ich za dużo albo nie będzie ich w ogóle, użytkownikowi wyświetli się mały alert, okienko z informacją.</p>

<p>Po przejściu przez warunek wysyłamy zapytanie przez API, gdzie obiekt z naszymi kryteriami jest przygotowywany w funkcji <code>prepCriteria</code>. Różne warunki (<code>null</code>, <code>undefined</code> lub <code>NaN</code>) wynikają z tego, jak dane pole w formularzu jest widziane przez JS w momencie, kiedy jest puste. Wartości ze sliderów dzielimy przez 100, bo API akceptuje w wypadku tych kryteriów zakres 0.00-1.00, a nie 0-100.</p>

<p>W linijce 5 mamy sytuację, w której otrzymaliśmy wyniki ze Spotify w obiekcie <code>data</code>. Należałoby z nimi coś zrobić, ale że wyświetlamy wyniki w osobnym widoku (pod przekierowaniem <code>/results</code>), do którego przyporządkowaliśmy w konfiguracji <code>ngRoute</code> kontroler <code>ResultsController</code>, to musimy jakoś skomunikować się między kontrolerami.</p>

<h3 id="resultscontroller-i-sharingresultsservice">ResultsController i SharingResultsService</h3>

<p>W AngularJS do tego celu służą Service (serwisy/usługi? <a href="https://www.p-programowanie.pl/angularjs/service-factory-provider-odchudzenie-kontrolera/">Tutaj</a> o nich więcej). Pozwalają one na komunikację pomiędzy kontrolerami. Na nasze potrzeby wystarczy bardzo prosta implementacja:</p>

<pre><code class="language-javascript">    // Service
    spotiBar.factory(&quot;SharingResultsService&quot;, function() {
      let sharingRecommendationResults = {
        data: {}
      };
      return sharingRecommendationResults;
    });
</code></pre>

<p>Kontrolery, które będą korzystać z <code>SharingResultsService</code> będą miały do dyspozycji obiekt <code>sharingRecommendationResults</code>. Na poziomie <code>SearchControllera</code> zapiszemy do tego obiektu wyniki wyszukiwania, zaś na poziomie <code>ResultsController</code> się do tych wyników odwołamy. Musimy zmodyfikować nieco nasz <code>SearchController</code>:</p>

<pre><code class="language-javascript">    spotiBar.controller(&quot;SearchController&quot;, [
      &quot;$scope&quot;,
      &quot;Spotify&quot;,
      &quot;SharingResultsService&quot;,
      function($scope, Spotify, SharingResultsService) {
        // $scope.searchSeeds = function() ....
    
        $scope.searchRecommendations = function() {
          if (checkIfSeedsInLimit()) {
            Spotify.getRecommendations(prepCriteria()).then(
              function(data) {
                SharingResultsService.data = data.data;
                console.log(data);
                document.location.href = &quot;/#!/results&quot;;
              },
              function(error) {
                alert(&quot;The access token expired. Please login again.&quot;);
              }
            );
          } else {
            alert(&quot;You can select up to 5 different seeds.&quot;);
          }
        };
        // reszta kodu kontrolera
    }]);
</code></pre>

<p>Względem poprzedniej wersji dodaliśmy <code>SharingResultsService</code> jako zależność oraz zapisaliśmy (linijka 12) wyniki.</p>

<p><code>ResultsController</code> będzie bardzo krótki. W obiekcie data nasze wyniki są pod tracks:</p>

<pre><code class="language-javascript">    spotiBar.controller(&quot;ResultsController&quot;, [
      &quot;$scope&quot;,
      &quot;SharingResultsService&quot;,
      function($scope, SharingResultsService) {
        $scope.recommendedTracks = SharingResultsService.data.tracks;
      }
    ]);
</code></pre>

<p>W naszym widoku wyników musimy ustawić odwołanie jako <code>recommendedTracks</code>.</p>

<h3 id="results-html">Results.html</h3>

<p>Jako że jeszcze go nie stworzyliśmy, to zrobimy to teraz. Tworzymy plik <code>results.html</code> w folderze <code>/views</code>:</p>

<pre><code class="language-html">    &lt;div class=&quot;container&quot;&gt;
        &lt;h1 class=&quot;spotify-font-artist-name&quot;&gt;Results:&lt;/h1&gt;
    
        &lt;div class=&quot;justify-content-center row&quot;&gt;
            &lt;div class=&quot;col-lg-2 col-md-3 col-sm-6 col-xs-12 text-center&quot; ng-repeat=&quot;track in recommendedTracks&quot; style=&quot;padding-left: 5px;padding-right: 5px;&quot;&gt;
    
                &lt;a href=&quot;{{track.album.uri}}&quot;&gt;&lt;img ng-src=&quot;{{track.album.images[1].url}}&quot; alt=&quot;&quot; style=&quot;width:170px;height:170px;&quot;&gt;&lt;/a&gt;
                &lt;br/&gt;
                &lt;div class=&quot;text-center&quot;&gt;
                    &lt;p style=&quot;margin-bottom: 0px;margin-top: 5px;&quot;&gt;
                        &lt;a class=&quot;spotify-font-artist-name&quot; ng-repeat=&quot;artist in track.artists&quot; href=&quot;{{artist.uri}}&quot;&gt;{{artist.name}} &lt;/a&gt;
                    &lt;/p&gt;
                    &lt;p class=&quot;text-warning&quot; style=&quot;margin-bottom: 0px;&quot;&gt;&lt;a class=&quot;text-warning&quot; href=&quot;{{track.uri}}&quot;&gt;{{track.name}}&lt;/a&gt;&lt;/p&gt;
                &lt;/div&gt;
    
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
</code></pre>

<p>Pomijając klasy Bootstrapowe (sprawiające, że nasze wyniki będą wyświetlane w kilku responsywnych kolumnach), ustawiliśmy <code>ng-repeat</code> na iteracje utworów w <code>recommendedTracks</code>. Wyświetlana jest okładka albumu, nazwa utworu i wykonawcy.</p>

<p>I to tyle!</p>

<p>Po zapisaniu i odpaleniu na serwerze lokalnym powinniśmy widzieć coś takiego:</p>

<p>Strona z kryteriami wyszukiwania:</p>

<p><img src="/images/oldblog/Screen-Shot-2018-04-20-at-21.56.05-1.png" alt="image-center" />{: .align-center}</p>

<p>Strona z wynikami:</p>

<p><img src="/images/oldblog/Screen-Shot-2018-04-20-at-21.56.16.png" alt="image-center" />{: .align-center}</p>

<p>I już! W następnej części poprawimy estetykę naszej aplikacji i dodamy instrukcję obsługi (mogliśmy od niej zacząć, właśnie sobie uświadomiłem, że użytkownik nie musi wiedzieć na czym polega wyszukiwanie rekomendacji w Spotify API ;)).</p>

<h2 id="part-4">PART 4</h2>

<p>W tym odcinku poprawimy nieco estetykę naszej aplikacji, dodamy instrukcję i ułatwimy UI.</p>

<h3 id="estetyka">Estetyka</h3>

<p>Skorzystamy z darmowej wersji <a href="https://designrevision.com/demo/shards/">Shards</a>, upiększającej nieco domyślnego Bootstrapa.</p>

<p>Tak było:</p>

<p><img src="/images/oldblog/SpotiBar01.png" alt="image-center" />{: .align-center}</p>

<p>A tak będzie:</p>

<p><img src="/images/oldblog/SpotiBar02.png" alt="image-center" />{: .align-center}</p>

<p>W samym wpisie wymienimy tylko najważniejsze zmiany, małe zmiany CSSowe pominę. Wszystko i tak jest na GitHub w nowszej wersji. Jest to bardziej wpis sprawozdawczy, niż poradnikowy. Zawsze można prześledzić historię repozytorium ;-).</p>

<h4 id="search-html-1">Search.html</h4>

<p>Zrezygnujemy z paczki rz-slider, na rzecz&hellip; niczego :). Slidery są mało wygodne, było ich za dużo i odciągały uwagę. Wyniki wyszukiwania z API też nie powalają precyzją, jeśli chodzi o kryteria, do których były suwaki&hellip; Zamiast tego są elementy select z kilkoma predefiniowanymi wartościami.</p>

<p>Prawą połowę ekranu wyszukiwania zajmie instrukcja, która będzie wyświetlana tak długo, jak długo użytkownik nie wyszuka seedów. Odpowiadają za to dyrektywy ng-switch i ng-switch-when.</p>

<p>Pełen kod dla search.html znajduje się poniżej:</p>

<pre><code class="language-html">    &lt;div class=&quot;container row mt-5 ml-5&quot;&gt;
    
      &lt;div class=&quot;col-md-6&quot;&gt;
    
        &lt;label class=&quot;col-form-label-lg&quot;&gt;1. Choose up to five tracks/genres/artists: &lt;/label&gt;
    
        &lt;form class=&quot;form-inline&quot;&gt;
          &lt;div class=&quot;input-group input-group-lg mx-sm-3 mb-2&quot;&gt;
            &lt;div class=&quot;input-group-prepend&quot;&gt;
              &lt;span class=&quot;input-group-text&quot;&gt;Seeds&lt;/span&gt;
            &lt;/div&gt;
            &lt;input type=&quot;text&quot; class=&quot;form-control&quot; id=&quot;form-seeds&quot; placeholder=&quot;Type in seeds query&quot; ng-model=&quot;seedsQuery&quot;&gt;
            &lt;div class=&quot;input-group-append&quot;&gt;
              &lt;button type=&quot;button&quot; class=&quot;btn btn-outline-secondary&quot; ng-click=&quot;searchSeeds()&quot;&gt;Find seeds&lt;/button&gt;
            &lt;/div&gt;
          &lt;/div&gt;
        &lt;/form&gt;
    
        &lt;label class=&quot;col-form-label-lg mr-5&quot;&gt;2. Search!&lt;/label&gt;
    
        &lt;button type=&quot;button&quot; class=&quot;btn btn-success btn-lg btn-block&quot; ng-click=&quot;searchRecommendations()&quot;&gt;Find tracks&lt;/button&gt;
    
        &lt;label class=&quot;col-form-label-lg&quot;&gt;* Optional criteria&lt;/label&gt;
    
        &lt;form&gt;
          &lt;div class=&quot;form-row&quot;&gt;
            &lt;div class=&quot;form-group col-md-6&quot;&gt;
              &lt;label for=&quot;inputDuration&quot; class=&quot;col-form-label-sm&quot;&gt;Duration: &lt;/label&gt;
              &lt;input id=&quot;inputDuration&quot; type=&quot;number&quot; class=&quot;form-control input-group-sm&quot; ng-model=&quot;durationInput&quot; placeholder=&quot;Duration in ms (&gt;0)&quot;&gt;
            &lt;/div&gt;
            &lt;div class=&quot;form-group col-md-6&quot;&gt;
              &lt;label for=&quot;inputLimit&quot; class=&quot;col-form-label-sm&quot;&gt;Limit: &lt;/label&gt;
              &lt;input id=&quot;inputLimit&quot; type=&quot;number&quot; class=&quot;form-control input-group-sm&quot; ng-model=&quot;limitInput&quot; placeholder=&quot;1-100 results&quot;&gt;
            &lt;/div&gt;
          &lt;/div&gt;
        &lt;/form&gt;
    
        &lt;form&gt;
          &lt;div class=&quot;form-row mb-3&quot;&gt;
            &lt;div class=&quot;form-group col-md-6&quot;&gt;
              &lt;label for=&quot;inputTempo&quot; class=&quot;col-form-label-sm&quot;&gt;Tempo (BPM): &lt;/label&gt;
              &lt;input id=&quot;inputTempo&quot; type=&quot;number&quot; class=&quot;form-control input-group-sm&quot; ng-model=&quot;tempoInput&quot; placeholder=&quot;Beats per minute (&gt;0)&quot;&gt;
            &lt;/div&gt;
            &lt;div class=&quot;form-group col-md-6&quot;&gt;
              &lt;label for=&quot;inputKey&quot; class=&quot;col-form-label-sm&quot;&gt;Key: &lt;/label&gt;
              &lt;input id=&quot;inputKey&quot; type=&quot;number&quot; class=&quot;form-control input-group-sm&quot; ng-model=&quot;keyInput&quot; placeholder=&quot;0 - C, 1 - C#, up to 11&quot;&gt;
            &lt;/div&gt;
          &lt;/div&gt;
        &lt;/form&gt;
    
        &lt;form&gt;
          &lt;div class=&quot;form-group row&quot;&gt;
            &lt;label for=&quot;inputMajor&quot; class=&quot;col-sm-5 col-form-label&quot;&gt;Major/Minor: &lt;/label&gt;
            &lt;div class=&quot;col-sm-7&quot;&gt;
              &lt;select id=&quot;inputMajor&quot; class=&quot;custom-select&quot; ng-model=&quot;isMajorSelect&quot;&gt;
                &lt;option value=&quot;&quot;&gt;Select....&lt;/option&gt;
                &lt;option value=&quot;1&quot;&gt;Major&lt;/option&gt;
                &lt;option value=&quot;0&quot;&gt;Minor&lt;/option&gt;
              &lt;/select&gt;
            &lt;/div&gt;
          &lt;/div&gt;
        &lt;/form&gt;
    
        &lt;form&gt;
          &lt;div class=&quot;form-group row&quot;&gt;
            &lt;label for=&quot;inputAcoustic&quot; class=&quot;col-sm-5 col-form-label&quot;&gt;Acousticness: &lt;/label&gt;
            &lt;div class=&quot;col-sm-7&quot;&gt;
              &lt;select id=&quot;inputAcoustic&quot; class=&quot;custom-select&quot; ng-model=&quot;acousticnessSelect&quot; ng-options=&quot;x.level for x in criteriaOptions&quot;&gt;
                &lt;option value=&quot;&quot;&gt;Select...&lt;/option&gt;
              &lt;/select&gt;
            &lt;/div&gt;
          &lt;/div&gt;
    
        &lt;/form&gt;
    
        &lt;form&gt;
          &lt;div class=&quot;form-group row&quot;&gt;
            &lt;label for=&quot;inputDanceability&quot; class=&quot;col-sm-5 col-form-label&quot;&gt;Danceability: &lt;/label&gt;
            &lt;div class=&quot;col-sm-7&quot;&gt;
              &lt;select id=&quot;inputDanceability&quot; class=&quot;custom-select&quot; ng-model=&quot;danceabilitySelect&quot; ng-options=&quot;x.level for x in criteriaOptions&quot;&gt;
                &lt;option value=&quot;&quot;&gt;Select...&lt;/option&gt;
              &lt;/select&gt;
            &lt;/div&gt;
          &lt;/div&gt;
        &lt;/form&gt;
    
        &lt;form&gt;
          &lt;div class=&quot;form-group row&quot;&gt;
            &lt;label for=&quot;inputEnergy&quot; class=&quot;col-sm-5 col-form-label&quot;&gt;Energy: &lt;/label&gt;
            &lt;div class=&quot;col-sm-7&quot;&gt;
              &lt;select id=&quot;inputEnergy&quot; class=&quot;custom-select&quot; ng-model=&quot;energySelect&quot; ng-options=&quot;x.level for x in criteriaOptions&quot;&gt;
                &lt;option value=&quot;&quot;&gt;Select...&lt;/option&gt;
              &lt;/select&gt;
            &lt;/div&gt;
          &lt;/div&gt;
        &lt;/form&gt;
    
        &lt;form&gt;
          &lt;div class=&quot;form-group row&quot;&gt;
            &lt;label for=&quot;inputLiveness&quot; class=&quot;col-sm-5 col-form-label&quot;&gt;Liveness: &lt;/label&gt;
            &lt;div class=&quot;col-sm-7&quot;&gt;
              &lt;select id=&quot;inputLiveness&quot; class=&quot;custom-select&quot; ng-model=&quot;livenessSelect&quot; ng-options=&quot;x.level for x in criteriaOptions&quot;&gt;
                &lt;option value=&quot;&quot;&gt;Select...&lt;/option&gt;
              &lt;/select&gt;
            &lt;/div&gt;
          &lt;/div&gt;
        &lt;/form&gt;
    
        &lt;form&gt;
          &lt;div class=&quot;form-group row&quot;&gt;
            &lt;label for=&quot;inputInstrument&quot; class=&quot;col-sm-5 col-form-label&quot;&gt;Instrumentalness: &lt;/label&gt;
            &lt;div class=&quot;col-sm-7&quot;&gt;
              &lt;select id=&quot;inputInstrument&quot; class=&quot;custom-select&quot; ng-model=&quot;instrumentalnessSelect&quot; ng-options=&quot;x.level for x in criteriaOptions&quot;&gt;
                &lt;option value=&quot;&quot;&gt;Select...&lt;/option&gt;
              &lt;/select&gt;
            &lt;/div&gt;
          &lt;/div&gt;
        &lt;/form&gt;
    
        &lt;form&gt;
          &lt;div class=&quot;form-group row&quot;&gt;
            &lt;label for=&quot;inputPopularity&quot; class=&quot;col-sm-5 col-form-label&quot;&gt;Popularity: &lt;/label&gt;
            &lt;div class=&quot;col-sm-7&quot;&gt;
              &lt;select id=&quot;inputPopularity&quot; class=&quot;custom-select&quot; ng-model=&quot;popularitySelect&quot; ng-options=&quot;x.level for x in criteriaOptions&quot;&gt;
                &lt;option value=&quot;&quot;&gt;Select...&lt;/option&gt;
              &lt;/select&gt;
            &lt;/div&gt;
          &lt;/div&gt;
        &lt;/form&gt;
    
        &lt;form&gt;
          &lt;div class=&quot;form-group row&quot;&gt;
            &lt;label for=&quot;inputSpeechiness&quot; class=&quot;col-sm-5 col-form-label&quot;&gt;Speechiness: &lt;/label&gt;
            &lt;div class=&quot;col-sm-7&quot;&gt;
              &lt;select id=&quot;inputSpeechiness&quot; class=&quot;custom-select&quot; ng-model=&quot;speechinessSelect&quot; ng-options=&quot;x.level for x in criteriaOptions&quot;&gt;
                &lt;option value=&quot;&quot;&gt;Select...&lt;/option&gt;
              &lt;/select&gt;
            &lt;/div&gt;
          &lt;/div&gt;
        &lt;/form&gt;
    
        &lt;form&gt;
          &lt;div class=&quot;form-group row&quot;&gt;
            &lt;label for=&quot;inputValence&quot; class=&quot;col-sm-5 col-form-label&quot;&gt;Valence: &lt;/label&gt;
            &lt;div class=&quot;col-sm-7&quot;&gt;
              &lt;select id=&quot;inputValence&quot; class=&quot;custom-select&quot; ng-model=&quot;valenceSelect&quot; ng-options=&quot;x.level for x in criteriaOptions&quot;&gt;
                &lt;option value=&quot;&quot;&gt;Select...&lt;/option&gt;
              &lt;/select&gt;
            &lt;/div&gt;
          &lt;/div&gt;
        &lt;/form&gt;
    
      &lt;/div&gt;
    
      &lt;div class=&quot;col-md-6&quot; ng-switch=&quot;seedOrInstruction&quot;&gt;
        &lt;div ng-switch-when=&quot;seeds&quot;&gt;
          &lt;div class=&quot;row&quot;&gt;
            &lt;div class=&quot;col-md-4&quot;&gt;
              &lt;label class=&quot;col-form-label-lg&quot;&gt;Artists:&lt;/label&gt;
              &lt;div class=&quot;row&quot; ng-repeat=&quot;artist in seedsArtists&quot;&gt;
                &lt;label&gt;
                  &lt;input type=&quot;checkbox&quot; checklist-model=&quot;seedsSelection.artists&quot; checklist-value=&quot;artist.id&quot; /&gt;
                  &lt;span&gt;{{artist.name}}&lt;/span&gt;
                &lt;/label&gt;
              &lt;/div&gt;
            &lt;/div&gt;
            &lt;div class=&quot;col-md-8&quot;&gt;
              &lt;label class=&quot;col-form-label-lg&quot;&gt;Tracks:&lt;/label&gt;
              &lt;div class=&quot;row&quot; ng-repeat=&quot;track in seedsTracks&quot;&gt;
                &lt;label&gt;
                  &lt;input type=&quot;checkbox&quot; checklist-model=&quot;seedsSelection.tracks&quot; checklist-value=&quot;track.id&quot; /&gt;
                  &lt;span&gt;{{track.name}} -&lt;/span&gt;
                  &lt;span ng-repeat=&quot;artist in track.artists&quot;&gt; &amp;nbsp;{{artist.name}} &lt;/span&gt;
                &lt;/label&gt;
              &lt;/div&gt;
            &lt;/div&gt;
          &lt;/div&gt;
          &lt;div class=&quot;row&quot;&gt;
            &lt;div class=&quot;col-md-12&quot;&gt;
              &lt;label class=&quot;col-form-label-lg&quot;&gt;Genres:&lt;/label&gt;
              &lt;br&gt;
              &lt;div class=&quot;form-check-inline&quot; ng-repeat=&quot;genre in seedsGenres&quot;&gt;
                &lt;label&gt;
                  &lt;input type=&quot;checkbox&quot; class=&quot;&quot; checklist-model=&quot;seedsSelection.genres&quot; checklist-value=&quot;genre&quot; /&gt; {{genre}}
                &lt;/label&gt;
              &lt;/div&gt;
            &lt;/div&gt;
          &lt;/div&gt;
    
        &lt;/div&gt;
        &lt;div ng-switch-when=&quot;instruction&quot;&gt;
      
          &lt;div class=&quot;jumbotron  jumbotron-fluid&quot;&gt;
            &lt;div class=&quot;container&quot;&gt;
            &lt;h4 class=&quot;display-4&quot;&gt;How to&lt;/h2&gt;
              &lt;p class=&quot;lead&quot;&gt;
                &lt;span class=&quot;font-weight-bold&quot;&gt;SpotiBar&lt;/span&gt; allows you to search Spotify recommendations based on several criteria. In order to use it, you
                should make sure that:&lt;/p&gt;
                &lt;ol class=&quot;list-group mb-4&quot;&gt;
                  &lt;li class=&quot;list-group-item&quot;&gt;You are signed in to your Spotify account. To do so, click the button in the top-right corner&lt;/li&gt;
                  &lt;li class=&quot;list-group-item&quot;&gt;You've selected
                    &lt;span class=&quot;font-weight-bold&quot;&gt;at least 1 and not more than 5&lt;/span&gt; seeds (artists/tracks/genres). You can search for them by quering
                    field on the left&lt;/li&gt;
                  &lt;li class=&quot;list-group-item&quot;&gt;(optional) You can also set optional criteria, such as Duration, Key and others to get more specific recommendations&lt;/li&gt;
                &lt;/ol&gt;
                &lt;hr class=&quot;my-4&quot;&gt;
                &lt;p class=&quot;lead&quot;&gt;Some optional criteria have ranges given in placeholders. Search mechanisms will ignore such criteria that are not within range.
              &lt;/p&gt;
            &lt;/div&gt;
        &lt;/div&gt;
        &lt;/div&gt;
      &lt;/div&gt;
    &lt;/div&gt;
</code></pre>

<h4 id="app-js-3">app.js (3)</h4>

<p>Jako że zrezygnowaliśmy z rz-slider, to paczka musi zniknąć również w naszej deklaracji modułu:</p>

<pre><code class="language-javascript">    const spotiBar = angular.module(&quot;spotiBar&quot;, [
      &quot;ngRoute&quot;,
      &quot;checklist-model&quot;,
      &quot;spotify&quot;,
    ]);
</code></pre>

<p>Oprócz tego zmienia się również nasz SearchController, tak aby uwzględnić rezygnację ze sliderów. Definiujemy między innymi criteriaOptions, do których są odwołania w search.html w elementach select. Mamy też inną formę walidacji kryteriów (nadal strasznie leniwą):</p>

<pre><code class="language-javascript">    spotiBar.controller(&quot;SearchController&quot;, [
      &quot;$scope&quot;,
      &quot;Spotify&quot;,
      &quot;SharingResultsService&quot;,
      function($scope, Spotify, SharingResultsService) {
        let seedsSelection = {};
    
        $scope.seedOrInstruction = &quot;instruction&quot;;
    
        $scope.criteriaOptions = [
          { level: &quot;Very low&quot;, value: &quot;0.00&quot; },
          { level: &quot;Low&quot;, value: &quot;0.25&quot; },
          { level: &quot;Medium&quot;, value: &quot;0.50&quot; },
          { level: &quot;High&quot;, value: &quot;0.75&quot; },
          { level: &quot;Very high&quot;, value: &quot;1.00&quot; }
        ];
    
        $scope.searchSeeds = function() {
          $scope.seedsSelection = seedsSelection;
          Spotify.getAvailableGenreSeeds().then(
            function(data) {
              $scope.seedOrInstruction = &quot;seeds&quot;;
              $scope.seedsGenres = data.data.genres;
            },
            function(error) {
              alert(&quot;The access token expired. Please login again.&quot;);
            }
          );
          Spotify.search($scope.seedsQuery, &quot;artist&quot;).then(function(data) {
            $scope.seedsArtists = data.data.artists.items;
          });
          Spotify.search($scope.seedsQuery, &quot;track&quot;).then(function(data) {
            $scope.seedsTracks = data.data.tracks.items;
          });
        };
    
        $scope.searchRecommendations = function() {
          if (checkIfSeedsInLimit()) {
            Spotify.getRecommendations(prepCriteria()).then(
              function(data) {
                SharingResultsService.data = data.data;
                console.log(data);
                document.location.href = &quot;/spotify-recommendations-app-js/#!/results&quot;;
              },
              function(error) {
                alert(&quot;The access token expired. Please login again.&quot;);
              }
            );
          } else {
            alert(&quot;You can select up to 5 different seeds.&quot;);
          }
        };
    
        checkIfSeedsInLimit = function() {
          if (
            $scope.seedsSelection == undefined ||
            ($scope.seedsSelection.artists == undefined &amp;&amp;
              $scope.seedsSelection.tracks == undefined &amp;&amp;
              $scope.seedsSelection.genres == undefined)
          ) {
            alert(&quot;You did not define any seeds&quot;);
            return false;
          }
    
          let numberOfSeeds = 0;
          if (!($scope.seedsSelection.artists == undefined)) {
            numberOfSeeds =
              numberOfSeeds + Object.keys($scope.seedsSelection.artists).length;
          }
          if (!($scope.seedsSelection.genres == undefined)) {
            numberOfSeeds =
              numberOfSeeds + Object.keys($scope.seedsSelection.genres).length;
          }
          if (!($scope.seedsSelection.tracks == undefined)) {
            numberOfSeeds =
              numberOfSeeds + Object.keys($scope.seedsSelection.tracks).length;
          }
          if (0 &lt; numberOfSeeds &amp;&amp; 5 &gt;= numberOfSeeds) {
            return true;
          } else {
            return false;
          }
        };
    
        prepCriteria = function() {
          let criteria = {};
          if ($scope.seedsSelection.artists != undefined) {
            criteria.seed_artists = $scope.seedsSelection.artists.join();
          }
          if ($scope.seedsSelection.tracks != undefined) {
            criteria.seed_tracks = $scope.seedsSelection.tracks.join();
          }
          if ($scope.seedsSelection.genres != undefined) {
            criteria.seed_genres = $scope.seedsSelection.genres.join();
          }
          if ($scope.limitInput != null) {
            if ($scope.limitInput &gt; 0 &amp;&amp; $scope.limitInput &lt; 101) {
              criteria.limit = $scope.limitInput;
            }
          }
          if ($scope.durationInput != null) {
            if ($scope.durationInput &gt; 0) {
              criteria.target_duration_ms = $scope.durationInput;
            }
          }
          if ($scope.keyInput != null) {
            if ($scope.keyInput &gt; -1 &amp;&amp; $scope.keyInput &lt; 12) {
              criteria.target_key = $scope.keyInput;
            }
          }
          if ($scope.isMajorSelect != null) {
            criteria.target_mode = $scope.isMajorSelect;
          }
          if ($scope.tempoInput != null) {
            if ($scope.tempoInput &gt; 0) {
              criteria.target_tempo = $scope.tempoInput;
            }
          }
          if ($scope.acousticnessSelect != null) {
            criteria.target_acousticness = $scope.acousticnessSelect.value;
          }
          if ($scope.danceabilitySelect != null) {
            criteria.target_danceability = $scope.danceabilitySelect.value;
          }
          if ($scope.energySelect != null) {
            criteria.target_energy = $scope.energySelect.value;
          }
          if ($scope.livenessSelect != null) {
            criteria.target_liveness = $scope.livenessSelect.value;
          }
          if ($scope.instrumentalnessSelect != null) {
            criteria.target_instrumentalness = $scope.instrumentalnessSelect.value;
          }
          if ($scope.popularitySelect != null) {
            criteria.target_popularity = $scope.popularitySelect.value;
          }
          if ($scope.speechinessSelect != null) {
            criteria.target_speechiness = $scope.speechinessSelect.value;
          }
          if ($scope.valenceSelect != null) {
            criteria.target_valence = $scope.valenceSelect.value;
          }
          return criteria;
        };
      }
    ]);
</code></pre>

<p>I to w zasadzie tyle&hellip; Pozostaje oczyszczenie elementu head w index.html ze zbędnych już bibliotek i dodanie Shards. Plus pomniejsze zmiany w CSS i atrybutach klas dla poszczególnych elementów strony :).</p>

<h4 id="czego-nie-ma-co-można-zmienić">Czego nie ma, co można zmienić</h4>

<ul>
<li>dodać prawdziwą walidację pól opcjonalnych, tak aby użytkownik nie mógł wyszukać rekomendacji, jeśli łamie zakres danego pola</li>
<li>dodać obsługę alertów, a nie polegać na wbudowanych w JS :)</li>
<li>polepszyć obsługę błędów</li>
<li>* zwiększyć czytelność JS, np. podzielić nasz plik JSowy</li>
<li>przesunąć Stringi do osobnego pliku i je wczytywać podług potrzeb</li>
</ul>

        </p>

        <div>
          <div class="post-back-link">
    <a href="javascript: history.back()">
        <i class="fa fa-arrow-left"></i> 
        Back
    </a>
</div>
        </div>
      </div>
    </div>
    

<footer>

</footer>

<script src="https://code.jquery.com/jquery-3.1.1.min.js"
  integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"
  integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script src="/js/prism.js"></script>

</body>

</html>
